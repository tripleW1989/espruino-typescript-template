setTime(1643124344.489);E.setTimeZone(8)
function e(a){return a&&typeof a==='object'&&'default'in a?a:{default:a}}Modules.addCached('ws',function(){function a(b,a){this.socket=null,a=a||{},this.host=b,this.port=a.port||80,this.protocolVersion=a.protocolVersion||13,this.origin=a.origin||'Espruino',this.keepAlive=1e3*a.keepAlive||6e4,this.masking=void 0!==a.masking?a.masking:!0,this.path=a.path||'/',this.protocol=a.protocol,this.lastData='',b=btoa(Math.random().toString(36).substr(2,8)+Math.random().toString(36).substr(2,8));var c=b+'258EAFA5-E914-47DA-95CA-C5AB0DC85B11';this.key={source:b,hashed:btoa(require('crypto').SHA1(c))},this.connected=a.connected||!1,this.headers=a.headers||{}}var b=String.fromCharCode;a.prototype.initializeConnection=function(){require('net').connect({host:this.host,port:this.port},this.onConnect.bind(this))},a.prototype.onConnect=function(b){this.socket=b;var a=this;b.on('data',this.parseData.bind(this)),b.on('close',function(){a.pingTimer&&(clearInterval(a.pingTimer),a.pingTimer=void 0),a.emit('close')}),this.handshake()},a.prototype.parseData=function(a){var h=this;if(this.emit('rawData',a),this.lastData.length&&(a=this.lastData+a,this.lastData=''),this.connected)for(;a.length;){var b=2,c=a.charCodeAt(0)&15,d=a.charCodeAt(1)&127;if(126==d)d=a.charCodeAt(3)|a.charCodeAt(2)<<8,b+=2;else if(127==d)throw'Messages >65535 in length unsupported';var f=d+b+(a.charCodeAt(1)&128?4:0);if(f>a.length){this.lastData=a;break}switch(c){case 10:this.emit('pong');break;case 9:this.send('pong',138);this.emit('ping');break;case 8:this.socket.end();break;case 0:case 1:c=[0,0,0,0];a.charCodeAt(1)&128&&(c=[a.charCodeAt(b++),a.charCodeAt(b++),a.charCodeAt(b++),a.charCodeAt(b++)]);for(var g='',e=0;e<d;e++)g+=String.fromCharCode(a.charCodeAt(b++)^c[e&3]);this.emit('message',g);break;default:console.log('WS: Unknown opcode '+c)}a=a.substr(f)}else-1<a.indexOf(this.key.hashed)&&-1<a.indexOf('\r\n\r\n')&&(this.emit('handshake'),this.pingTimer=setInterval(function(){h.send('ping',137)},this.keepAlive),a=a.substring(a.indexOf('\r\n\r\n')+4),this.connected=!0,this.emit('open')),this.lastData=a},a.prototype.handshake=function(){var a=['GET '+this.path+' HTTP/1.1','Host: '+this.host,'Upgrade: websocket','Connection: Upgrade','Sec-WebSocket-Key: '+this.key.source,'Sec-WebSocket-Version: '+this.protocolVersion,'Origin: '+this.origin];this.protocol&&a.push('Sec-WebSocket-Protocol: '+this.protocol);for(var b in this.headers)this.headers.hasOwnProperty(b)&&a.push(b+': '+this.headers[b]);this.socket.write(a.join('\r\n')+'\r\n\r\n')},a.prototype.send=function(d,e){var c=d.length;if(125<d.length&&(c=126),this.socket.write(b(void 0===e?129:e,c+(this.masking?128:0))),126==c&&(this.socket.write(b(d.length>>8)),this.socket.write(b(d.length))),this.masking){e=[],c='';for(var a=0;4>a;a++){var f=Math.floor(255*Math.random());e[a]=f,c+=b(f)}for(a=0;a<d.length;a++)c+=b(d.charCodeAt(a)^e[a&3]);this.socket.write(c)}else this.socket.write(d)},a.prototype.close=function(){this.socket.end()},exports=function(b,c){return b=new a(b,c),b.initializeConnection(),b},exports.createServer=function(c){var b=require('http').createServer(function(e,g){if(e.headers.Connection&&0<=e.headers.Connection.indexOf('Upgrade')){var f=e.headers['Sec-WebSocket-Key'];f={Upgrade:'websocket',Connection:'Upgrade','Sec-WebSocket-Accept':btoa(E.toString(require('crypto').SHA1(f+'258EAFA5-E914-47DA-95CA-C5AB0DC85B11')))},e.headers['Sec-WebSocket-Protocol']&&(f['Sec-WebSocket-Protocol']=e.headers['Sec-WebSocket-Protocol']),g.writeHead(101,f);var d=new a(void 0,{masking:!1,connected:!0});d.socket=g,e.on('data',d.parseData.bind(d)),e.on('close',function(){clearInterval(d.srvPing),d.srvPing=void 0,d.emit('close')}),d.srvPing=setInterval(function(){d.emit('ping',!0),d.send('ping',137)},d.keepAlive),b.emit('websocket',d)}else c(e,g)});return b}});var t=require('ws'),i=require('Wifi'),o=e(t),r=e(i),n=function(){function a(a){this.wsHandler=function(a){return function(b){b.on('open',function(){console.log('Connected to server')}),b.on('message',a),b.on('close',function(a){console.log('bye bye')})}},this.startServer(a)}return a.prototype.startServer=function(b){var a=o['default'].createServer(this.pageHandler);a.on('websocket',this.wsHandler(b)),a.listen(80)},a.prototype.pageHandler=function(b,a){a.writeHead(200,{'Content-Type':'text/html'}),a.end('hello')},a}(),s=function(){function a(b){var c=b.name,d=b.password,e=b.callback;this.isConnect=!1,this.connect(c,d,e),a.startAp()}return a.prototype.connect=function(a,b,c){var d=this;a===void 0&&(a='ChinaNet-Eqis'),b===void 0&&(b='2xhhnwws'),r['default'].connect(a,{password:b},function(a){a?console.log('wifi connect fail',a):(console.log('wifi connect success'),d.isConnect=!0,c&&c())})},a.startAp=function(a){r['default'].startAP('EspruinoAP',{password:'12345678',authMode:'wpa2'},function(b){console.log('startAP success!'),b&&console.log('err',b),a&&a(),r['default'].getAPIP(function(a,b){console.log('Connected!'),console.log('err',a),console.log('ip',b)})})},a}(),a=0,c=1,d=function(){function b(a,b,c,d){a===void 0&&(a=NodeMCU.D1),b===void 0&&(b=NodeMCU.D2),c===void 0&&(c=NodeMCU.D3),d===void 0&&(d=NodeMCU.D4),this.init(a,b,c,d)}return b.prototype.init=function(a,b,c,d){this.IN1=a,this.IN2=b,this.IN3=c,this.IN4=d,pinMode(this.IN1,'output',!0),pinMode(this.IN2,'output',!0),pinMode(this.IN3,'output',!0),pinMode(this.IN4,'output',!0)},b.prototype.forward=function(){digitalWrite(this.IN1,a),digitalWrite(this.IN2,c),digitalWrite(this.IN3,a),digitalWrite(this.IN4,c)},b.prototype.back=function(){digitalWrite(this.IN1,c),digitalWrite(this.IN2,a),digitalWrite(this.IN3,c),digitalWrite(this.IN4,a)},b.prototype.stop=function(){digitalWrite(this.IN1,a),digitalWrite(this.IN2,a),digitalWrite(this.IN3,a),digitalWrite(this.IN4,a)},b.prototype.left=function(){digitalWrite(this.IN1,a),digitalWrite(this.IN2,c),digitalWrite(this.IN3,c),digitalWrite(this.IN4,a)},b.prototype.right=function(){digitalWrite(this.IN1,c),digitalWrite(this.IN2,a),digitalWrite(this.IN3,a),digitalWrite(this.IN4,c)},b}(),l=function(){function a(){var a=this;this.auth='2dcdd31adcec',this.ssid='ChinaNet-Eqis',this.password='2xhhnwws',this.handler=function(b){console.log(a.driver);switch(b){case'right':a.driver.right();break;case'left':a.driver.left();break;case'forward':a.driver.forward();break;case'stop':a.driver.stop();break}},this.startUp=function(){a.driver=new d,s.startAp(function(){a.server=new n(a.handler)})},console.log('server start'),this.startUp()}return a}();new l